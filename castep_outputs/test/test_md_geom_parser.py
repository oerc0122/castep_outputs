# pylint: skip-file
import io
import pprint
from unittest import TestCase, main

from castep_outputs import parse_md_geom_file


class test_md_geom_parser(TestCase):
    def test_parser(self):
        test_text = io.StringIO("""
        BEGIN header

        END header
                      0.0000000000000000E+000
                     -3.1438056609022318E+001   -3.1376043990507860E+001    2.5277616819407205E-002  <-- E
                      2.1064680682839339E-003                                                        <-- T
                      1.4675541909861883E-004                                                        <-- P
                      1.0261212863294524E+001    0.0000000000000000E+000    0.0000000000000000E+000  <-- h
                      0.0000000000000000E+000    1.0261212863294524E+001    0.0000000000000000E+000  <-- h
                      0.0000000000000000E+000    0.0000000000000000E+000    1.0261212863294524E+001  <-- h
                      0.0000000000000000E+000    0.0000000000000000E+000    0.0000000000000000E+000  <-- hv
                      0.0000000000000000E+000    0.0000000000000000E+000    0.0000000000000000E+000  <-- hv
                      0.0000000000000000E+000    0.0000000000000000E+000    0.0000000000000000E+000  <-- hv
                      5.3947667434339923E-005    3.5567533768348789E-005    8.1607367238056459E-005  <-- S
                      3.5567533768348789E-005   -2.2263123614334223E-004    1.5275407397741958E-004  <-- S
                      8.1607367238056459E-005    1.5275407397741958E-004   -2.7158268858685418E-004  <-- S
 Si              1    0.0000000000000000E+000    0.0000000000000000E+000    0.0000000000000000E+000  <-- R
 Si              2    0.0000000000000000E+000    5.1306064316472622E+000    5.2845246245966804E+000  <-- R
 Si              1    1.6461326428344710E-004    4.5089543337825654E-005    1.2682182569746878E-004  <-- V
 Si              2    8.4803099578915976E-005    1.4834634371448861E-004    3.0659125052563604E-004  <-- V
 Si              1   -4.7485150541330739E-003   -6.4256923548756568E-003    6.2722754436370046E-003  <-- F
 Si              2    7.3746443515239476E-003    6.2703809926870444E-003   -1.9171200407951994E-002  <-- F

        """)
        test_dict = parse_md_geom_file(test_text)

        self.assertEqual(test_dict, [{'E': [[-31.43805660902232,
                                             -31.37604399050786,
                                             0.025277616819407205]],
                                      'P': [[0.00014675541909861883]],
                                      'S': [[5.394766743433992e-05,
                                             3.556753376834879e-05,
                                             8.160736723805646e-05],
                                            [3.556753376834879e-05,
                                             -0.00022263123614334223,
                                             0.00015275407397741958],
                                            [8.160736723805646e-05,
                                             0.00015275407397741958,
                                             -0.0002715826885868542]],
                                      'T': [[0.002106468068283934]],
                                      'energy': [[-31.43805660902232,
                                                  -31.37604399050786,
                                                  0.025277616819407205]],
                                      'h': [[10.261212863294524, 0.0, 0.0],
                                            [0.0, 10.261212863294524, 0.0],
                                            [0.0, 0.0, 10.261212863294524]],
                                      'hv': [[0.0, 0.0, 0.0], [0.0, 0.0, 0.0], [0.0, 0.0, 0.0]],
                                      'lattice_vectors': [[10.261212863294524, 0.0, 0.0],
                                                          [0.0, 10.261212863294524, 0.0],
                                                          [0.0, 0.0, 10.261212863294524]],
                                      'lattice_velocity': [[0.0, 0.0, 0.0],
                                                           [0.0, 0.0, 0.0],
                                                           [0.0, 0.0, 0.0]],
                                      'pressure': [[0.00014675541909861883]],
                                      'temperature': [[0.002106468068283934]],
                                      'time': 0.0,
                                      ('Si', 1): {'F': (-0.004748515054133074,
                                                        -0.006425692354875657,
                                                        0.006272275443637005),
                                                  'R': (0.0, 0.0, 0.0),
                                                  'V': (0.0001646132642834471,
                                                        4.5089543337825654e-05,
                                                        0.00012682182569746878),
                                                  'force': (-0.004748515054133074,
                                                            -0.006425692354875657,
                                                            0.006272275443637005),
                                                  'position': (0.0, 0.0, 0.0),
                                                  'velocity': (0.0001646132642834471,
                                                               4.5089543337825654e-05,
                                                               0.00012682182569746878)},
                                      ('Si', 2): {'F': (0.007374644351523948,
                                                        0.006270380992687044,
                                                        -0.019171200407951994),
                                                  'R': (0.0, 5.130606431647262, 5.28452462459668),
                                                  'V': (8.480309957891598e-05,
                                                        0.0001483463437144886,
                                                        0.00030659125052563604),
                                                  'force': (0.007374644351523948,
                                                            0.006270380992687044,
                                                            -0.019171200407951994),
                                                  'position': (0.0,
                                                               5.130606431647262,
                                                               5.28452462459668),
                                                  'velocity': (8.480309957891598e-05,
                                                               0.0001483463437144886,
                                                               0.00030659125052563604)}}])


if __name__ == '__main__':
    main()
